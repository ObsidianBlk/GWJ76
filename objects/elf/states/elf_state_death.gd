extends ElfState
class_name ElfStateDeath

# ------------------------------------------------------------------------------
# Signals
# ------------------------------------------------------------------------------


# ------------------------------------------------------------------------------
# Constants and ENUMs
# ------------------------------------------------------------------------------
const ANIM_DEATH : StringName = &"death"

const TRANSITION_IDLE : StringName = &"Idle"

# ------------------------------------------------------------------------------
# Export Variables
# ------------------------------------------------------------------------------


# ------------------------------------------------------------------------------
# Variables
# ------------------------------------------------------------------------------
var _reason : StringName = &""

# ------------------------------------------------------------------------------
# Onready Variables
# ------------------------------------------------------------------------------


# ------------------------------------------------------------------------------
# Setters / Getters
# ------------------------------------------------------------------------------


# ------------------------------------------------------------------------------
# Override Methods
# ------------------------------------------------------------------------------


# ------------------------------------------------------------------------------
# Private Methods
# ------------------------------------------------------------------------------
func _RequestDeath() -> void:
	host.dead.emit(_reason)

# ------------------------------------------------------------------------------
# Public Methods
# ------------------------------------------------------------------------------
func enter(payload : Variant = null) -> void:
	if host == null: return
	if typeof(payload) == TYPE_STRING_NAME:
		_reason = payload
	var anim : StringName = &"%s_%s"%[ANIM_DEATH, _reason]
	if host.has_animation(anim):
		host.animation_finished.connect(_on_host_animation_finished)
		host.play_animation(anim)
	#else:
		#transition.emit(TRANSITION_IDLE)

# ------------------------------------------------------------------------------
# Handler Methods
# ------------------------------------------------------------------------------
func _on_host_animation_finished(anim_name : StringName) -> void:
	if anim_name.begins_with(ANIM_DEATH):
		_RequestDeath.call_deferred()


